---
# Pre-commit hooks configuration for HFortix
# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks

# Suppress warnings about deprecated stage names from upstream repos
default_install_hook_types: [pre-commit, pre-merge-commit, pre-push, commit-msg]
default_stages: [pre-commit]

repos:
  # General pre-commit hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
        exclude: ^(docs/|X/|\.venv/|venv/|build/|dist/)
      - id: end-of-file-fixer
        exclude: ^(docs/|X/|\.venv/|venv/|build/|dist/)
      - id: check-yaml
        args: [--unsafe]  # Allow custom YAML tags
      - id: check-json
      - id: check-toml
      - id: check-added-large-files
        args: ['--maxkb=500']
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: mixed-line-ending
        args: [--fix=lf]
        exclude: ^(docs/|X/|\.venv/|venv/|build/|dist/)
      - id: detect-private-key
        # Generated API stubs can contain key-like strings; exclude them.
        exclude: ^(hfortix/FortiOS/api/v2/|docs/|X/)

  # Python code formatting with Black
  - repo: https://github.com/psf/black
    rev: 24.10.0
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=79]
        exclude: ^(docs/|X/|\.venv/|venv/|build/|dist/|hfortix/FortiOS/api/v2/cmdb/|hfortix/FortiOS/api/v2/monitor/)

  # Import sorting with isort (compatible with Black)
  - repo: https://github.com/PyCQA/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: [--profile=black, --line-length=79]
        exclude: ^(docs/|X/|\.venv/|venv/|build/|dist/)

  # Flake8 linting
  - repo: https://github.com/PyCQA/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        # Config is in .flake8 file (max-line-length=79, ignores E203/W503, per-file-ignores for api/)
        # Exclude generated API code with multi-line f-strings that flake8 can't parse
        exclude: ^(docs/|X/|\.venv/|venv/|build/|dist/|hfortix/FortiOS/api/v2/cmdb/.*/_helpers/|hfortix/FortiOS/api/v2/monitor/)
        additional_dependencies:
          - flake8-bugbear

  # Type checking with mypy
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        language_version: python3
        exclude: ^(docs/|X/|\.venv/|venv/|build/|dist/|hfortix/FortiOS/api/v2/cmdb/.*/_helpers/|hfortix/FortiOS/api/v2/monitor/)
        additional_dependencies:
          - types-requests
          - httpx
        args: [--ignore-missing-imports, --no-strict-optional]

  # Security linting with bandit
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.6
    hooks:
      - id: bandit
        args: [-c, pyproject.toml]
        exclude: ^(docs/|X/|\.venv/|venv/|build/|dist/)
        additional_dependencies: ["bandit[toml]"]

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.33.0
    hooks:
      - id: yamllint
        args: [-d, '{extends: default, rules: {line-length: {max: 120}}}']

  # Markdown linting
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.38.0
    hooks:
      - id: markdownlint
        args: [--config, .markdownlint.json]
        exclude: ^(X/|CHANGELOG\.md|QUICKSTART\.md|docs/|hfortix/FortiOS/firewall/.*\.md)

# Configuration for pre-commit.ci (if using)
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: []
  submodules: false
